{% extends "xml_analyzer/base.html" %}
{% load custom_filters %}

{% block content %}
<div class="container bg-white p-4 rounded shadow">
    <h2 class="text-center text-dark mb-4">Upload XML Report and Enter Base Folder Path</h2>

    <form method="POST" enctype="multipart/form-data" class="mb-4">
        {% csrf_token %}
        <div class="mb-3">
            <label class="form-label">Select XML Report File:</label>
            <input type="file" name="xml_file" accept=".xml" class="form-control" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Enter Base Folder Path:</label>
            <input type="text" name="base_folder" placeholder="e.g., D:/FWtestResultAnalyzer/ProjectFolder" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-warning w-100 fw-bold">Upload and Analyze</button>
    </form>    

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} fw-bold">{{ message }}</div>
        {% endfor %}
    {% endif %}

    {% if analysis_result %}
        <h3 class="text-center text-success mb-3">ðŸ§ª Analysis Result</h3>

        <ul class="nav nav-tabs" id="resultTabs" role="tablist">
            {% for tab in statuses %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link {% if forloop.first %}active{% endif %}" id="{{ tab }}-tab"
                            data-bs-toggle="tab" data-bs-target="#{{ tab }}"
                            type="button" role="tab" aria-controls="{{ tab }}" aria-selected="true">
                        {{ tab|capfirst }} ({{ analysis_result|get_item:tab|length }})
                    </button>
                </li>
            {% endfor %}
        </ul>

        <div class="tab-content p-3 border border-top-0 bg-light rounded-bottom" id="resultTabsContent">
            {% for tab in statuses %}
                <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="{{ tab }}" role="tabpanel" aria-labelledby="{{ tab }}-tab">
                    {% with tests=analysis_result|get_item:tab %}
                        {% if tests %}
                            <ul class="list-group">
                                {% for test in tests %}
                                    {% if test != '...' and test != None %}
                                        <li class="list-group-item">
                                            <strong>{{ test.classname }}</strong> â€” {{ test.name }}
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-muted">No {{ tab }} tests found.</p>
                        {% endif %}
                    {% endwith %}
                </div>
            {% endfor %}
          </div>
          {% endif %}
      
          {% if message %}
              <p>{{ message }}</p>
              <a href="{% url 'results' %}"><button class="btn btn-success">View Results</button></a>
          {% endif %}
      </div>
      {% endblock %}
      